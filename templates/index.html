<!DOCTYPE html>

<html lang="en">

<head>
	<title>静妮找房</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta name="description" content="RyanRent">
	
	<link rel="stylesheet" href="static/bootstrap.min.css">

	<script src="static/jquery-3.1.1.min.js"></script>
	<script src="static/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
	<script src="static/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script> 

	<!-- boostrap table -->
	<link rel="stylesheet" href="static/bootstrap-table.min.css">
	<script src="static/bootstrap-table.min.js"></script>
	<script src="static/bootstrap-table-zh-CN.min.js"></script>

	<link rel="stylesheet" type="text/css" href="static/style.css">

</head>
<body>
    <header>
		<nav class="navbar navbar-expand-lg navbar-dark" style="background-color: black;">
		  <div class="container">
		    <a class="navbar-brand" href="/"><img src="static/my.png" width="35" height="35" class="d-inline-block align-top mr-sm-2" alt="" >静妮找房</a>

			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="navbarNavAltMarkup">
				<div class="navbar-nav">
					<a class="nav-item nav-link active" href="/">首页 <span class="sr-only">(homepage)</span></a>
				</div>
			</div>
			<div class="navbar-collapse collapse order-3 dual-collapse2">
		        <ul class="navbar-nav ml-auto">
		            <li class="nav-item">
		                <a class="nav-item nav-link active" href="/">关于</a>
		            </li>
		        </ul>
		    </div>

		  </div>
		</nav>

		<nav class="navbar navbar-expand-lg navbar-light bg-light">
		    <div class="container">

		      <div class="form-inline">
			    <input id='searchipt' class="form-control mr-sm-2 mb-sm-0" type="search" placeholder="输入区域、地铁站或小区名开始找房" aria-label="Search" style="width:380px">
			    <button id="searchbtn" class="btn btn-success">搜索</button>
		      </div>

		    </div>
		</nav>
    </header>

  	<div class="bg-light">
	  	<div class="container bg-light">

		<!--	<nav class="border-top-0"> -->
			  <div class="nav nav-tabs bg-light" id="nav-tab" role="tablist">
				    <a class="nav-item mynav-item nav-link active text-dark method" id="nav-home-tab" data-toggle="tab" href="#nav-home" role="tab" aria-controls="nav-home" aria-selected="true">区域找房</a>
				    <a class="nav-item mynav-item nav-link text-dark method" id="nav-profile-tab" data-toggle="tab" href="#nav-profile" role="tab" aria-controls="nav-profile" aria-selected="false">地铁找房</a>

			  </div>
		</div>
	</div>

	<script type="text/javascript">

		/* get options in the page */
		function ttc(){
			method = $('.nav-item.active.method').text();
			area = $(".area.option-list a.on").text();
			subway = $(".subway.option-list a.on").text();
			suboption = $('#line-sub-list a.on').text()
			zffs = $(".zffs.option-list a.on").text();
			search = $("#searchipt").val()

			result = {
				'method': method,
				'area': area,
				'subway': subway,
				'suboption': suboption,
				'zffs': zffs,
				'search': search
			}
			
			return result;
		}

		function add_sublist_click_function(){
		    $("#line-sub-list a").click(function(e) {
		    	$("#searchipt").val('')
		        $("#line-sub-list a").removeClass('on');
		        $(e.target).addClass('on');

		        $("#table").bootstrapTable('destroy');
				update_table(ttc())
		    });
		}


		function update_table(parameters) {
			console.log(parameters)
			$('#table').bootstrapTable({
	            url: '/jsondata',
	            method: 'get',
			    queryParams: function (p) {
			        return {
			            id: 'aa', 
			            limit: p.limit,
			            offset: p.offset,
			            method: parameters['method'],
			            area: parameters['area'],
						subway: parameters['subway'],
						suboption: parameters['suboption'] ,
						zffs: parameters['zffs'],
						search: parameters['search']
			        };
			    },
	            dataType: "json",
	            pagination: true, //前端处理分页
	            singleSelect: false,//是否只能单选
	            search: false, //显示搜索框，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大
	            striped: false, //是否显示行间隔色
	            cache: false, //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）
	            pageNumber: 1, //初始化加载第10页，默认第一页
	            pageSize: 15, //每页的记录行数（*）
	            pageList: [15, 30, 60, 100], //可供选择的每页的行数（*）
	            strictSearch: true,//设置为 true启用 全匹配搜索，false为模糊搜索
	            showColumns: false, //显示内容列下拉框
	            showRefresh: false, //显示刷新按钮
	            minimumCountColumns: 2, //当列数小于此值时，将隐藏内容列下拉框
	            clickToSelect: true, //设置true， 将在点击某行时，自动勾选rediobox 和 checkbox
	            uniqueId: "id", //每一行的唯一标识，一般为主键列
	            showToggle: false, //是否显示详细视图和列表视图的切换按钮
	            cardView: false, //是否显示详细视图
	            detailView: false, //是否显示父子表，设置为 true 可以显示详细页面模式,在每行最前边显示+号#}
	            sidePagination: "server", //分页方式：client客户端分页，server服务端分页（*）
	            buttonsClass: 'light',
	            columns: [
	            {
	                field: 'title',
	                title: '租房信息',
	                align: 'left',
	                formatter: function (value, row, index) {
	                	var color = value.flag == '0'? '' : 'text-danger'
	                    var e = '<a class="' + color + ' ' + 'target="_blank"  href="' + value.href + '">' + value.title + '</a>'
	                    return e;
	                }
	            }, {
	                field: 'post_time',
	                title: '发布时间',
	                align: 'center',
	            }, {
	                field: 'user',
	                title: '是否中介(beta)',
	                align: 'center',
	                formatter: function (value, row, index) {
	                	var color = value.flag == '0'? '' : 'bg-danger text-white'
	                    var e = '<div class="' + color + ' ">' + value.u + '</div> '
	                    return e;
	                }
	            },{
	                field: 'source',
	                title: '来源',
	                align: 'center'
	            }],
	        });
		}



		function get_sub_options(type_p, value) {
			$.ajax({
				url: '/get_sub_options',
				type: 'get',
			    data: {
			        	'type': type_p,
			        	'value': value
			          },
				dataType: 'json',
				success: function(data) {
			        var bodyFa = document.getElementById("line-sub-list");
			        bodyFa.innerHTML = ""
			        var a = document.createElement("a");
			        a.innerText = '不限'
			        a.classList.add('on')
			        a.classList.add('suball')
			        a.href = '#'
			        bodyFa.appendChild(a);

			        //<a class="allsub on" href="#" id="0">不限</a>

			        for (var i = data['data'].length - 1; i >= 0; i--) {
			        	var a=document.createElement("a");
			        	a.innerText = data['data'][i];
				        a.href = '#';
				        bodyFa.appendChild(a);
			        }
			        add_sublist_click_function()
				}
			})
		}


		$(function(){
			$("#searchbtn").click(function(e) {
				parameters = ttc()
				parameters['search'] = $("#searchipt").val()
				$("#table").bootstrapTable('destroy');
				update_table(parameters)

		    });


			$(".mynav-item").click(function(e) {
		        $(".option-list a").removeClass('on'); 
		        $('.all').addClass('on');
		        $("#line-sub-list a").removeClass('on');
		        $('.allsub').addClass('on');
		        $('#line-sub-list').hide()

				parameters = ttc()
				parameters['method'] = e.target.innerHTML;
				$("#table").bootstrapTable('destroy');
				update_table(parameters)
		    });

		    $(".area.option-list a").click(function(e) {
		    	$("#searchipt").val('')
		        $(".area.option-list a").removeClass('on');
		        $(e.target).addClass('on'); 
		        $("#line-sub-list a").removeClass('on');
		        $('#line-sub-list').show();
		        $('.allsub').addClass('on');

		        get_sub_options('area', e.target.innerHTML)
				$("#table").bootstrapTable('destroy');
				update_table(ttc())
		    });

		    $(".subway.option-list a").click(function(e) {
		    	$("#searchipt").val('')
		        $(".subway.option-list a").removeClass('on');
		        $(e.target).addClass('on'); 
		        $("#line-sub-list a").removeClass('on');
		        $('#line-sub-list').show();
		        $('.allsub').addClass('on');

		        get_sub_options('subway', e.target.text)
		        
				$("#table").bootstrapTable('destroy');
				update_table(ttc())
		    });

		    $(".hide.all").click(function(e) {
		    	$("#searchipt").val('')
				$('#line-sub-list').hide()
		    });


		    $(".zffs.option-list a").click(function(e) {
		        $(".zffs.option-list a").removeClass('on');
		        $(e.target).addClass('on');

				$("#table").bootstrapTable('destroy');
				update_table(ttc())
		    });

		})

	</script>



	<div class="container">
			<div class="tab-content border-right border-left" id="nav-tabContent">
				<div class="tab-pane show active" id="nav-home" role="tabpanel" aria-labelledby="nav-home-tab">
				    <div class="card-body" style="padding:1.25rem 1.25rem 0px;">
				        <div class="bd" id="filter-options">
				            <dl class="dl-lst clear" style="margin-bottom: 0rem;">
				                <dt>区域：</dt>
				                <dd data-index="0">
				                    <div class="option-list area">
				                        <a href="#" class="hide all on">不限</a>
				                        <a href="#">东城</a>
				                        <a href="#">西城</a>
				                        <a href="#">朝阳</a>
				                        <a href="#">海淀</a>
				                        <a href="#">丰台</a>
				                        <a href="#">石景山</a>
				                        <a href="#">通州</a>
				                        <a href="#">昌平</a>
				                        <a href="#">大兴</a>
				                        <a href="#">亦庄开发区</a>
				                        <a href="#">顺义</a>
				                        <a href="#">房山</a>
				                        <a href="#">门头沟</a>
				                    </div>
				                </dd>
				            </dl>
				        </div>
				    </div>
				</div>

				<div class="tab-pane" id="nav-profile" role="tabpanel" aria-labelledby="nav-profile-tab">
					<div class="card-body" style="padding:1.25rem 1.25rem 0px;">
					    <div class="bd" id="filter-options">
					        <dl class="dl-lst clear" style="margin-bottom: 0rem;">
					        	<dt>地铁：</dt>
					            <dd data-index="1">
					                <div class="option-list subway">
										<a href="#" class="hide all on">不限</a>
										<a href="#">1号线</a>
										<a href="#">2号线</a>
										<a href="#">4号线</a>
										<a href="#">5号线</a>
										<a href="#">6号线</a>
										<a href="#">7号线</a>
										<a href="#">8号线</a>
										<a href="#">9号线</a>
										<a href="#">10号线</a>
										<a href="#">13号线</a>
										<a href="#">14号线(东段)</a>
										<a href="#">14号线(西段)</a>
										<a href="#">15号线</a>
										<a href="#">16号线</a>
										<a href="#">八通线</a>
										<a href="#">亦庄线</a>
										<a href="#">昌平线</a>
										<a href="#">房山线</a>
										<a href="#">机场线</a>
										<a href="#">燕房线</a>
										<a href="#">S1线</a>
										<a href="#">西郊线</a>
					                </div>
					            </dd>
					        </dl>
					    </div>
					</div>
				</div>


				<div class="card-body border-bottom" style="margin-bottom: 10px; padding:0px 1.25rem 0.25rem;">
		  			<div class="bd" id="filter-options">
							<div class="sub-option-list" id="line-sub-list" style="display: none; width:100%">
		                        
		               		</div>

			            <dl class="dl-lst clear">
			                <dt>方式：</dt>
			                <dd data-index="0">
			                    <div class="option-list zffs">
			                        <a href="#" class="all on">不限</a>
			                        <a href="#">求租</a>
			                        <a href="#">整租</a>
			                    </div>
			                </dd>
			            </dl>
			        </div>
			    </div>
			</div>

        <div style="width: 100%; margin: 0 auto">
            <table id="table" style="font-size:15px;"></table>
        </div>

	</div>  <!-- contrainer -->


	<div class="container">
		<hr />
		<footer>
			<div style="width:100%">
				<span class="font-weight-light" style="float:left;font-size:15px">总:{{ sta.tip }}IP, {{ sta.tpv }} PV | 今:{{ sta.dip }}IP, {{ sta.dpv }}PV </span>
				<span class="font-weight-light" style="float:right;font-size:15px">&copy; Ryan 2016</span>
			</div>
		</footer>
	</div>
	<!-- /container -->


	<script type="text/javascript">

	   $(function () {
	        parameters = ttc()
	        update_table(parameters)
	    });



	</script>

</body>
</html>